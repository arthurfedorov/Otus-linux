# Пользователи и группы. Аутентификация и авторизация

## TO-DO

- [x] Основное задание
- [x] Задание со *

## Домашнее задание

- Запретить всем пользователям, кроме группы admin логин в выходные (суббота и воскресенье), без учета праздников

- Со * - дать конкретному пользователю права работать с докером и возможность рестартить докер сервис

---

Для проверки выполнения домашнего задания, необходимо склонировать репозиторий, перейти в соответствующую папку PAM и командой **vagrant up** поднять виртуальную машину

> [!IMPORTANT]
> В случае, если Ansible установлен в virtualenv (как у меня), необходимо активировать виртуальное окружение.

После того как Ansible запровижинит все, можно логиниться под учетками:

- *day* - аутентификация доступна каждый день с 08:00 - 20:00

- *night* - аутентификация доступна каждый день с 20:00 - 08:00

- *friday* - аутентификация доступна весь день в пятницу

- *admin* - аутентификация доступна всегда

Потратил несколько дней на то выяснение причины, почему не запускаются под учеткой night, admin, одна из причин - некорректная timezone vagrant машины (UTC 0), изменил timezone на Europe/Moscow заработало, но осталась проблема с запуском только в рабочие дни, которая должна была решиться добавлением параметра *Wd*, но не взлетело и поэтому добавил все рабочие дни *MoTuWeThFr*. Аналогично *Al* также не сработало, выход - *MoTuWeThFrSaSu*.

> [!IMPORTANT]
> Необходимо удалить ключ локальной машины Vagrant из **~/.ssh/known_hosts**. Не смог побороть эту проблему, каждый раз при инициализации новой машины, приходится удалять ключ и проверить на каком порту висит ssh до машины командой **vagrant ssh-config**.

Запуск docker.service доступен для учетной записи *day*. В ходе проведения анализа обнаружено несколько вариантов реализации запуска конкретного сервера не sudo пользователем:

1. Добавление PolKit rules.

> [!IMPORTANT]
> Работает только с версии systemd >==226. В CentOS 7.6 systemd == 219.

```javascript
polkit.addRule(function(action, subject) {
    if (action.id == "org.freedesktop.systemd1.manage-units" &&
    action.lookup("unit") == "docker.service" &&
    subject.user == "day") {
        return polkit.Result.YES;
    }
});
```

2. Редактирование sudoers. Выбран данный метод

Но и здесь возникла проблема, не воспринимается параметр *NOPASSWD*, поэтому для работы c сервисом docker, необходимо использовать пароль *vagrant*.